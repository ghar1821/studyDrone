{% extends "notes/base_notes.html" %}

{% load staticfiles %}

{% block page-title %}View Individual Group - {{group.name}}{% endblock %}

{% block primary %}

<div class="span7 section-center">
	<ul class="breadcrumb">
		<li><a href="/notes">Notes</a> <span class="divider">/</span></li>
		<li><a href="/notes/view-groups">View Groups</a> <span class="divider">/</span></li>
		<li class="active">{{group.name}}</li>
	</ul>

	<div class="page-header">
		<h1>{{group.name}}</h1>
	</div>
	
	<a class="btn btn-primary" href="/notes/create-group"><i class="icon-envelope-alt"></i> Send Message</a>
	<a class="btn btn-primary" href="/notes/upload-notes"><i class="icon-upload"></i> Upload Note</a>
	<a class="btn btn-danger" onclick="leaveGroup()" href="/notes/leave-group"><i class="icon-remove-circle"></i> Leave Group</a>
	<form method="post" action="" id="leave_group">
		{% csrf_token %}
		<input type="hidden" name="group_id" value={{group.id}}>
	</form>
	<script>
	function leaveGroup() 
	{
		document.forms["leave_group"].submit();
	}
	</script>

	<hr>
	
	<h3>Group Notes</h3>
	
		<div class="upload-table">
		
				{% if notes %}
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th class="uploaded-table-title">Title</th>
                            <th class="uploaded-table-col">Upload Date</th>
                            <th class="uploaded-table-col">Downloads</th>
                            <th class="uploaded-table-col">Actions</th>
                        </tr>
                    </thead>
                    <tbody> 
                        {% for note in notes %}
                            <tr>    
                                {# title #}
                                <td>
                                    <form id="form-goto-note-{{note.id}}" action="/notes/view-individual-note/" method="post">
                                        {% csrf_token %}
                                        <input style="display: none" class="span12" type="text" name="note-id" value="{{ note.id }}">
                                        <a href="#" onclick="submitGoToNoteId({{note.id}});">
                                            {{note.title}}
                                        </a>
                                    </form>
                                </td>
                                {# upload date #}
                                <td>{{note.upload_time}}</td>
                                {# download count #}
                                <td>{{note.download_count}}</td>
                                {# action buttons #}
                                <td>
									<form id="form-delete-note" action="/notes/edit-note/" method="post">
										{% csrf_token %}
                                        <input style="display: none" class="span12" type="text" name="note_id" value="{{ note.id }}">
										<a href="#"><i onclick="submitEditNote({{note.id}});" class="icon-edit"></i> Edit</a><br>
									</form>
                                    <form id="form-delete-note" action="/notes/delete-note/" method="post">
                                        {% csrf_token %}
                                        <input style="display: none" class="span12" type="text" name="note-id" value="{{ note.id }}">
                                        <a href="#" onclick="submitDeleteNote({{note.id}});" class="icon-ban-circle"> Remove </a>
                                    </form>
									<script>
										function submitEditNote() 
										{
											document.forms["form-edit-note"].submit();
										}
										function submitDeleteNote() 
										{
											document.forms["form-delete-note"].submit();
										}
									</script>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                    <p> No notes uploaded </p>
                {% endif %}
			</div>
		
</div>

{% endblock %}

{% block secondary %}

<div class="span3 section-right">
	<ul class="nav nav-list nav-related-notes">
		<li class="nav-header">
		GROUP DETAILS
		</li>
		<li>
		<p>title: {{group.name}}</p>
		</li>
		<li>
		<p>description: {{group.description}}</p>
		</li>
		<li>
		<p>date created: {{group.created_since}}</p>
		</li>
		<li>
		<hr>
		</li>		
		<li class="nav-header">
		GROUP MEMBERS
		</li>
		{% for member in group.members.all %}
		<li>
		<img style="float: none" class="nav-avatar" src="/static/common/images/user-avatar.png"><p style="display: inline"><a href="/notes/view-individual-user/{{member.id}}">{{member.first_name}} {{member.last_name}}</a></p>
		</li>
		{% endfor %}
	</ul>
</div>

{% endblock %}

{% block functions %}

<script>
  // set defaults
  $.fn.raty.defaults.half = true;
  $.fn.raty.defaults.hints = ['', '', '', '', ''];
  // bind divs
  $('#my-rating').raty();
  $('#avg-rating').raty({ score: 4.5, readOnly: true });
</script>

{% endblock %}

